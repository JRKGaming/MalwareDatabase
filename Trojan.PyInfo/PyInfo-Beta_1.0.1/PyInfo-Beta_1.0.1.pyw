import requests
import socket
import os
from pyuac import main_requires_admin
from cpuinfo import get_cpu_info
import random
import platform


def getOSName():
	return platform.platform()


def getOSRelease():
	return platform.release()


def randomName():
	chars = 'abcdefghijklmnopqrstuvwxyz1234567890'
	rand_name = random.choices(chars, k=15)
	joined_randName = ''.join(rand_name)
	full_name = joined_randName+'.txt'
	return full_name


def getCpuInfo():
	return get_cpu_info()['brand_raw']


def check_connection():
	try:
		socket.create_connection(('google.com', 80))
		return True
	except:
		return False


def getUserDirectory():
	usrDir = os.path.expanduser("~")
	return usrDir


def getHostName():
	hostname = socket.gethostname()
	return hostname


def getIp():
	try:
		requestIp = requests.get('https://api.ipify.org')
		ip = requestIp.text
		return ip
	except:
		pass

 
@main_requires_admin
def main():
	is_connected = check_connection()
	if is_connected == True:
		pass
	else:
		quit()


	ipAddr = getIp()
	hostName = getHostName()
	userDir = getUserDirectory()
	cpuName = getCpuInfo()
	osName = getOSName()
	osRelease = getOSRelease()

	with open(os.getenv("LOCALAPPDATA")+randomName(), 'w') as f:
		f.write(f'IP Address: {ipAddr}\n\n\nHost Name: {hostName}\n\n\nUser Directory: {userDir}\nCPU Name: {cpuName}\nOS Name: {osName}\nOS Release: {osRelease}')


if __name__ == '__main__':
	main()